<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv = "X-UA-Compatible" content = "IE = edge" charset = "UTF-8"/> 
		<title>TEST</title>
		<!-- <link rel = "stylesheet" href = "../src/main/webapp/pages/css/wanma.css"/> -->
		<link rel = "stylesheet" href = "../src/main/webapp/tools/easyui/themes/default/easyui.css"/>
		<!-- <link rel = "stylesheet" href = "../src/main/webapp/tools/easyui/themes/icon.css"/> -->
		
		<script type = "text/javascript" src = "../src/main/webapp/tools/tssJS/tssJS.all.js"></script>
		
		<script type = "text/javascript" src = "../src/main/webapp/tools/easyui/jquery.min.js"></script>
		<script type = "text/javascript" src = "../src/main/webapp/tools/easyui/jquery.easyui.min.js"></script>
		<script type = "text/javascript" src = "../src/main/webapp/tools/easyui/easyui-lang-zh_CN.js"></script>
		
		<script type = "text/javascript" src = "../src/main/webapp/tools/echarts/echarts-3.1.5.js"></script>
		<!-- <script type = "text/javascript" src = "../src/main/webapp/more/bi_template/echart.js"></script> -->
		<!-- <script type = "text/javascript" src = "../src/main/webapp/more/bi_template/common.js"></script> -->
		<!-- <script type = "text/javascript" src = "../src/main/webapp/pages/js/common.js"></script> -->
		<script type = "text/javascript">
			var data1; //, data2, data3
			// data1 按区域选项中的区域外数据， data2 按区域选项中的区域内数据， data3 按分拨选择
			var URL1 = "http://10.45.10.216:8080/tss/data/json/2168";
			//var	URL2 = "http://10.45.10.216:8080/tss/data/json/2150";
			
			
			var method = "POST";
			//var params = {"param1": "-1"};
			

			
			$(function(){
			
				tssJS.ajax({
				url: URL1,
				params: {"param1": "-1"},
				method: method,
				waiting: true,
				ondata: function(){
					data1 =  this.getResponseJSON();
					tree(data1)
					}
				});	
				
				
			});
				
			function tree(data1){
				var regobj = new Object(), typeobj = new Object();
				var rows = [];
				var json = {"rows":[], "footer":[]};
				var j = 1;
				
				//区域编号
				$.each(data1, function(i, item){
					var reg = item.in_reg; 
					if(regobj[reg] == null){
						regobj[reg] = j;
						//console.log(regobj);
						rows.push({"id":j, "_parentId":null, "name":reg, "capacity": item.c_in1+item.c_out, "line": item.l_in1+item.l_out1,"state":"closed"});
						j++;
					};	
				});
				//车型编号
				var j = 1
				$.each(data1, function(i, item){
					var type = item.type;
					if(typeobj[type] == null){
						typeobj[type] = j;
						j++;
					}
				})
				
				//第二层
				var templist = []; 
				$.each(data1, function(i, item){
					var reg = item.in_reg;
					var pid = regobj[reg];
					if(!templist.contains(reg)){
						templist.push(reg);
						rows.push({"id":pid*10+1, "_parentId": pid, "name":"区域内", "capacity": item.c_in1, "line": item.l_in1,"state":"closed"});
						rows.push({"id":pid*10+2, "_parentId": pid, "name":"区域外", "capacity": item.c_out1, "line": item.l_out1,"state":"closed"})
					}
				});
				
				//第三层区域内
				var j = 1;  var templist = [];
				$.each(data1, function(i, item){
					var type = item.in_reg + item.type;
					var pid = regobj[item.in_reg];
					if((!templist.contains(type))&&(item.c_in != 0) &&(item.l_in != 0) ){
						templist.push(type);
						rows.push({"id":pid*100+10+typeobj[item.type], "_parentId": pid*10+1, "name":item.type, "capacity":item.c_in, "line":item.l_in,"state":"closed"})
					}
				});
				
				//第三层区域外
				var j = 1; var templist = []; //var route = {};
				$.each(data1, function(i, item){
					var in_to = item.in_reg + "→" + item.to_reg;
					var pid = regobj[item.in_reg];
					if(!templist.contains(in_to)){
						templist.push(in_to);
						rows.push({"id":pid*1000+200+pid*10+regobj[item.to_reg], "_parentId": pid*10+2, "name":in_to, "capacity":item.c_out2, "line":item.l_out2,"state":"closed"})
					}
					//route[in_to] = pid*100+20+j;
				});
				
				//第四层区域外
				var j = 1; var templist = [];
				$.each(data1, function(i, item){
					var in_to = item.in_reg + "→" + item.to_reg;
					var type = in_to + item.type;
					var pid = regobj[item.in_reg];
					if(!templist.contains(type)){
						templist.push(type);
						rows.push({"id":pid*10000+2000+pid*100+regobj[item.to_reg]*10+typeobj[item.type], "_parentId": pid*1000+200+pid*10+regobj[item.to_reg], "name":item.type, "capacity":item.c_out, "line":item.l_out,"state":"closed"})
					}
				});
				
				
				json["rows"] = rows;
				
				$("#tree").treegrid({
					idField:'id',
					treeField:'name',
					width: 900,
					height: 900,
					//rownumbers: true,
					//showFooter: true,
					//animate: true,
					data: json
				});
			};
				

			
			
		</script>
	</head>
	<body>
		<div>
			<table id = "tree" style = "width:100%; height:100%">
				<thead>
					<tr>
						<th data-options = "field: 'name'" width = "40%">名称</th>
						<th data-options = "field: 'line'" width = "30%">车线</th>
						<th data-options = "field: 'capacity'" width = "30%">运力</th>
					</tr>
				</thead>
			</table>
		</div>
	</body>
</html>